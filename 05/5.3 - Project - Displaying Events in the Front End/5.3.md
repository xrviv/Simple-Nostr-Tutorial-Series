## Display Events in a Web Page

### Previously

1. We've generated our private key (Lesson 2.1)
2. Derived its NIP-19 equivalent (Lesson 2.2)
3. We derived the public key from this private key (Lesson 2.1)
4. We encoded the public key according to NIP-19 specifications (Lesson 2.2)
5. We defined our event template (Lesson 3.2)
6. We signed the event with our private key (Lesson 3.2)
7. We published an event to a relay and learned about NoteIDs (Lesson 4.6)
8. Built a Basic User Interface with Express.js for NOSTR (Lesson 5.1)
    - Step 1: Install Express.js and Dependencies
    - Step 2: Set Up the Express Server
    - Step 3: Add NOSTR Functionality to the Server
    - Step 4: Test the Server
9. Create a basic HTML frontend for the express.js nostr server (Lesson 5.2)
    - Remove the JSON response after clicking `Publish Event`
    - Log the JSON response in the console instead

**In Lesson 5.3 - Displaying Events in the Front End**

10. Subscribe to events in a relay, and display these in a webpage.

#### Prerequisites

- Go to the directory `nostr-app`
- Run `npm install express ws nostr-tools` 
- Run `node server.js` first. 
- Open http://localhost:3000, which should open `index.html` in a browser.

`server.js` and `index.html` forms a basic web application that connects to a Nostr relay, subscribes to all text note events (kind 1), and then forwards these events to any connected WebSocket clients. The setup is straightforward and aligns well with typical patterns for building real-time web applications using Node.js, Express, and WebSocket.

Here's a brief breakdown of how the code works:

### server.js

1.  **Setup Express and HTTP Server:** You're using Express to serve your web content (`index.html`) and creating an HTTP server which integrates with the WebSocket server.
2.  **WebSocket Server:** You initialize a WebSocket server that listens for client connections. When a client connects or disconnects, it logs these events to the console.
3.  **Nostr Relay Subscription:** The function `subscribeToAllTextNotes` connects to a Nostr relay at `wss://relay.damus.io`. It subscribes to all events of kind 1 (text notes) and, upon receiving an event, broadcasts this event to all connected WebSocket clients.
4.  **Listening on Port 3000:** Your HTTP server listens on port 3000 and serves your `index.html` page.

### index.html

1.  **WebSocket Client Setup:** When the page loads, it sets up a WebSocket connection to your server at `ws://localhost:3000`.
2.  **Handling Incoming Messages:** When a message is received from the WebSocket server, it's parsed from JSON, and its content is added to an unordered list in the HTML.

The page generated should look like this: 

![image](https://github.com/xrviv/Simple-Nostr-Tutorial-Series/assets/44260360/17cee44f-0d8e-400d-b7d8-af922dd65143)

The data looks quite unkempt as it outputs the entire JSON, including other fields. 

*Code for displaying events including other fields*

```
<script>
    var socket;

    function setupWebSocket() {
        socket = new WebSocket('ws://localhost:3000');
        socket.onmessage = function(event) {
            var data = JSON.parse(event.data);
            var node = document.createElement("LI");
            var textnode = document.createTextNode(JSON.stringify(data));
            node.appendChild(textnode);
            document.getElementById("eventsList").appendChild(node);
        };
    }

    window.onload = setupWebSocket;
</script>
```

We will replace it with this code, which should only show the `content` field.

```
<script>
    var socket;

    function setupWebSocket() {
        socket = new WebSocket('ws://localhost:3000');
        socket.onmessage = function(event) {
            var data = JSON.parse(event.data);
            
            // Check if the data contains a content field
            if (data.content) {
                var node = document.createElement("LI");
                var textnode = document.createTextNode(data.content);
                node.appendChild(textnode);
                document.getElementById("eventsList").appendChild(node);
            }
        };
    }

    window.onload = setupWebSocket;
</script>
```

### Notes

1. In our previous implementation, we used: 

```
app.get('/', (req, res) => {
    res.sendFile(__dirname + '/index.html');
});
```

This specified that only index.html received the data. So when I created a new page with content only output, it encountered an error. I commented out the `app.get` line and instead opted for: 

```
app.use(express.static(path.join(__dirname, 'public')));
```

- Then added `const path = require('path');`
- Created the folder `public`, where both `index.html` and `content.html` reside. 
- I then linked to `content.html` where only the content is shown in the page.
- I then linked to a slightly styled `styled.html` where the content and time-stamp is showed in the middle column

#### Content Only `content.html`

![image](https://github.com/xrviv/Simple-Nostr-Tutorial-Series/assets/44260360/c2f8eac3-950c-4e99-b0cb-39df4e166acb)

#### Styled content `styled.html`

![image](https://github.com/xrviv/Simple-Nostr-Tutorial-Series/assets/44260360/1cc8b028-3868-4615-b91a-66df50cf81cc)





